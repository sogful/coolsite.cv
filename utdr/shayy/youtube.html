<!DOCTYPE html>
<html lang="en">
<head>

    <title>YouTube Archive</title>
    <link rel="icon" type="image/png" href="../assets/images/icons/notshayy.png">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <style>

        @font-face {
            font-family: "Roboto";
            src: url("assets/fonts/robotovariable.ttf");
        }

        /*//////////////////////////////////////////////////////////////////////*/

        /* very not nabbed color palette */
        :root {
            --white: #f1f1f1;
            --text-primary: #f1f1f1;
            --text-secondary: #aaa;
            --blue: #3ea6ff;
            --grey: #717171;
            --bg-primary: #0f0f0f;
            --bg-secondary: #181818;
            --bg-hover: #272727;
            --border: #303030;
            --pill-bg: rgba(255,255,255,0.1);
        }

        body {
            font-family: "Roboto", "Arial", sans-serif;
            display: flex; justify-content: center;
            min-height: 100vh; margin: 0;
            background: #0F0F0F; color: var(--white);
            overflow-y: auto; scrollbar-width: none;
        }
        ::-webkit-scrollbar {
            display: none;
        }
        .page {
            width: min(90vw);
            padding: 0;
        }

        :any-link {
            color: var(--blue);
            text-decoration: none;
        }

        /*//////////////////////////////////////////////////////////////////////*/

        /* awkwardly crops if it doesn't fit */
        .channelheader {
            position: relative;
            width: 100%; max-width: 660px;
            background: var(--bg-secondary);
            margin-left: auto; margin-right: auto;
        }
        .channelbanner {
            width: 100%; max-width: 660px; height: 200px;
            background-size: cover; background-position: center;
            background-color: var(--bg-secondary);
            display: block; margin-left: auto; margin-right: auto;
        }

        .channelinfo {
            position: relative; padding: 16px 24px 24px; 
            background: var(--bg-primary);
        }

        .channelcontent {
            max-width: 1280px; margin: 0 auto;
            display: flex; align-items: flex-start; gap: 24px;
        }

        .channelavatar {
            width: 80px; height: 80px; border-radius: 50%;
            background: var(--bg-secondary); flex-shrink: 0;
        }

        .channeldetails {flex: 1; min-width: 0}
        .channelnamerow {
            display: flex; align-items: center; 
            margin-bottom: 8px
        }

        .channelname {
            font-size: 24px; font-weight: 400; 
            color: var(--text-primary);
            line-height: 1; margin: 0;
        }

        .channelmeta {
            display: flex; align-items: center; 
            gap: 8px; flex-wrap: wrap;
            font-size: 14px; color: var(--text-secondary); 
            margin-bottom: 12px;
        }
        .channelmetaseparator {color: var(--text-secondary)}

        .channeldescription {
            font-size: 14px; color: var(--text-primary); 
            line-height: 20px
        }

        .button {
            padding: 10px 16px; border-radius: 18px; font-size: 14px;
            font-weight: 500; font-family: inherit;
            cursor: pointer; border: none; transition: opacity 0.2s;
        }

        .button:hover {opacity: 0.9}
        .buttonprimary {background: var(--text-primary); color: var(--bg-primary)}
        .buttonsecondary {background: var(--bg-hover); color: var(--text-primary)}

        /*//////////////////////////////////////////////////////////////////////*/

        .tabs {
            max-width: 1280px; margin: 0 auto; border-bottom: 1px solid var(--border);
            padding: 0 24px; background: var(--bg-primary); position: sticky;
            top: 0; z-index: 10;
        }
        .tabscontainer {display: flex; gap: 32px}

        .tab {
            padding: 16px 0; font-size: 14px; font-weight: 500;
            color: var(--text-secondary); cursor: pointer;
            border-bottom: 2px solid transparent; margin-bottom: -1px;
            transition: color 0.2s; background: none;
            border-top: none; border-left: none; border-right: none;
            font-family: inherit;
        }
        .tab:hover {color: var(--text-primary)}
        .tab.active {color: var(--text-primary); border-bottom-color: var(--text-primary)}

        /*//////////////////////////////////////////////////////////////////////*/

        .contentarea {
            max-width: 1280px;
            margin: 0 auto; padding: 24px
        }

        .watchoverlay {
            position: fixed; inset: 0;
            align-items: center; justify-content: center;
            background: rgba(0, 0, 0, 0.85); z-index: 1000;
            display: none; padding: 24px;
            opacity: 0; transition: opacity 0.3s ease;
        }

        .watchoverlay.visible {display: flex; opacity: 1}

        .watchpanel {
            background: var(--bg-primary); border-radius: 16px; border: 1px solid var(--border);
            padding: 24px; max-width: 1280px; width: 100%; max-height: 90vh;
            overflow-y: auto; position: relative; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .watchclose {
            position: absolute; display: flex; 
            top: 16px; right: 16px; 
            width: 40px; height: 40px;
            border-radius: 50%; border: none; background: var(--bg-hover);
            color: var(--text-primary); cursor: pointer;
            align-items: center; justify-content: center;
            z-index: 10;
        }
        .watchclose:hover {background: var(--border)}
        .watchclose svg {width: 24px; height: 24px}

        .watchplayer {
            position: relative; width: 100%; aspect-ratio: 16 / 9;
            background: #000; border-radius: 12px; overflow: hidden;
        }
        .watchplayer iframe {
            width: 100%; height: 100%;
            border: 0; display: block
        }

        .watchdetails {
            margin-top: 16px; display: flex;
            flex-direction: column; gap: 16px;
        }

        .watchheader h2 {margin: 0; font-size: 20px; font-weight: 500}

        .watchmeta {font-size: 14px; color: var(--text-secondary); margin-top: 4px}

        .watchactions {display: flex; flex-wrap: wrap; gap: 8px}

        /*//////////////////////////////////////////////////////////////////////*/

        .dlbutton {
            background: var(--pill-bg); border-radius: 999px; 
            border: 1px solid var(--border);
            padding: 6px 14px; font-size: 13px; 
            color: var(--text-primary); cursor: pointer;
            display: inline-flex; align-items: center; 
            justify-content: center; gap: 6px;
            text-decoration: none; font-family: inherit; 
            transition: background 0.2s, border-color 0.2s;
        }

        .dlbutton:hover:not([disabled]) {opacity: 0.9}
        .dlbutton[disabled] {opacity: 0.5; cursor: not-allowed}
        .dlbutton[hidden] {display: none !important}

        .watchdescription {
            font-size: 14px; line-height: 1.6; 
            color: var(--text-primary); white-space: pre-wrap
        }

        /*//////////////////////////////////////////////////////////////////////*/

        .watchdescription p {margin-top: 0; margin-bottom: 1em}
        .watchdescription a {color: var(--blue)}

        .watchdescriptionmore {
            color: var(--text-primary); font-weight: 500; 
            cursor: pointer; display: inline-flex;
            align-items: baseline; gap: 4px; margin-top: 4px;
        }

        .watchdescriptionmore::before {content: "..."; color: var(--text-secondary)}
        .watchdescriptionmore b {text-transform: lowercase; letter-spacing: 0.1px}
        .watchdescriptionmore:hover {text-decoration: underline}

        /*//////////////////////////////////////////////////////////////////////*/

        .search {position: relative; margin-bottom: 24px; max-width: 90%}

        .searchicon {
            position: absolute; left: 16px; top: 50%; transform: translateY(-50%);
            width: 20px; height: 20px; opacity: 0.5; pointer-events: none;
        }

        .searchinput {
            width: 100%; height: 40px; padding: 0 16px 0 48px;
            border-radius: 40px; border: 1px solid var(--border);
            background: var(--bg-secondary); color: var(--text-primary);
            font-family: inherit; font-size: 16px; caret-color: var(--blue);
        }

        .searchinput::placeholder {color: var(--text-secondary)}
        .searchinput:focus {outline: none; border-color: var(--blue)}

        /*//////////////////////////////////////////////////////////////////////*/

        .videogrid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 16px;
        }

        .videogrid .empty-state {
            grid-column: 1 / -1; color: var(--text-secondary);
            font-size: 15px; padding: 16px 0
        }

        .videoitem {
            cursor: pointer; transition: transform 0.2s, opacity 0.2s; 
            padding: 8px; border-radius: 16px;
            border: 1px solid transparent; background: transparent;
        }
        .videoitem:hover {opacity: 0.9}

        .videothumbnail {
            position: relative; width: 100%; background: var(--bg-secondary);
            border-radius: 12px; overflow: hidden; margin-bottom: 12px;
        }

        .videothumbnail img {
            width: 100%; height: 100%; 
            object-fit: cover; background: var(--bg-secondary);
            opacity: 0; transition: opacity 0.3s;
        }

        .videothumbnail img.loaded {opacity: 1}

        /* looks like poop from a butt */
        .videoduration {
            position: absolute; bottom: 4px; right: 4px; 
            background: rgba(0, 0, 0, 0.75);
            color: var(--text-primary); padding: 2px 4px; 
            border-radius: 5px; font-size: 12px; font-weight: 500;
        }

        .videoinfo {display: flex; gap: 12px}

        .videochannelavatar {
            width: 36px; height: 36px; 
            border-radius: 50%; flex-shrink: 0; 
            background: var(--bg-secondary);
        }

        .videodetails {flex: 1; min-width: 0}

        .videotitle {
            font-size: 16px; font-weight: 500; 
            color: var(--text-primary); line-height: 22px; margin-bottom: 4px;
            display: -webkit-box; -webkit-line-clamp: 2;
            line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
        }

        .videometa {
            font-size: 14px; color: var(--text-secondary); line-height: 20px;
            display: flex; flex-wrap: wrap; gap: 4px;
        }

        .videometaseparator {margin: 0 4px; color: var(--text-secondary)}

        /*//////////////////////////////////////////////////////////////////////*/

        @media (max-width: 768px) {
            .contentarea {padding: 16px}
            .tabs {padding: 0 16px}
            .watchpanel {padding: 12px}
        }

        /*//////////////////////////////////////////////////////////////////////*/
    </style>
</head>
<body>
    <div class="page">

        <section class="channelheader">
            <div class="channelbanner" style="background-image: url('assets/images/banner.webp');"></div>
            <div class="channelinfo">
                <div class="channelcontent">
                    <img src="assets/images/pfp.jpg" alt="Shayy" class="channelavatar">
                    <div class="channeldetails">
                        <div class="channelnamerow">
                            <h1 class="channelname">Shayy</h1>
                        </div>
                        <div class="channelmeta">
                            <span>@ShayyTV</span>
                            <span class="channelmetaseparator">•</span>
                            <span id="subscribercount">471K subscribers</span>
                            <span class="channelmetaseparator">•</span>
                            <span id="videocount">(loading)</span>
                        </div>
                        <div class="channeldescription">
                            Speedrunner and enjoyer of Undertale and Deltarune!
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="tabs">
            <div class="tabscontainer">
                <button class="tab active" data-tab="videos">Videos</button>
                <button class="tab" data-tab="shorts">Shorts</button>
            </div>
        </div>

        <div class="watchoverlay" id="watchoverlay" aria-live="polite">
            <div class="watchpanel">
                <button class="watchclose" id="watchclose" aria-label="Close">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
                    </svg>
                </button>
                <div class="watchplayer">
                    <iframe id="watchframe" title="Video player" loading="lazy" allowfullscreen></iframe>
                </div>
                <div class="watchdetails">
                    <div class="watchheader">
                        <h2 id="watchtitle">Choose a video</h2>
                        <div class="watchmeta" id="watchmeta">Nothing selected yet.</div>
                    </div>
                    <div class="watchactions">
                        <a class="dlbutton" id="watchdownload-transcript" download hidden>Transcript (.xlsx)</a>
                        <a class="dlbutton" id="watchdownload-comments" download hidden>Comments (.xlsx)</a>
                    </div>
                    <div class="watchdescription" id="watchdescription">
                        Select a video to load its archived description.
                    </div>
                </div>
            </div>
        </div>

        <div class="contentarea">

            <div class="search">
                <svg class="searchicon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M11 2a9 9 0 1 0 5.641 16.01.966.966 0 0 0 .152.197l3.5 3.5a1 1 0 1 0 1.414-1.414l-3.5-3.5a1 1 0 0 0-.197-.153A8.96 8.96 0 0 0 20 11a9 9 0 0 0-9-9Zm0 2a7 7 0 1 1 0 14 7 7 0 0 1 0-14Z"></path>
                </svg>
                <input class="searchinput" placeholder="Search videos" type="text">
            </div>

            <div id="videos" class="videogrid" aria-live="polite"></div>
        </div>

    </div>

    <script>
        const videosroot = document.getElementById("videos");
        const searchinput = document.querySelector(".searchinput");
        const watchoverlay = document.getElementById("watchoverlay");
        const watchpanel = document.querySelector(".watchpanel");
        const watchclose = document.getElementById("watchclose");
        const watchframe = document.getElementById("watchframe");
        const watchtitle = document.getElementById("watchtitle");
        const watchmeta = document.getElementById("watchmeta");
        const watchdescription = document.getElementById("watchdescription");
        const watchdownloadtranscript = document.getElementById("watchdownload-transcript");
        const watchdownloadcomments = document.getElementById("watchdownload-comments");
        const tabs = document.querySelectorAll(".tab");

        let videos = [];
        let filteredvideos = [];
        let renderedcount = 0;
        let loading = false;
        let activevideoid = null;
        let activetab = "videos";
        const descriptioncache = new Map();
        const videomap = new Map();

        /*//////////////////////////////////////////////////////////////////////*/

        initmain();
        async function initmain() {
            try {
                const res = await fetch("assets/static/videos.json", {cache: "no-cache"});
                if (!res.ok) throw 0;
                videos = await res.json();
                videos.sort((a, b) => {
                    const ad = new Date(a.publishdate).getTime() || 0;
                    const bd = new Date(b.publishdate).getTime() || 0;
                    if (ad !== bd) return bd - ad;
                    return (b.videoid || "").localeCompare(a.videoid || "");
               });
                for (const v of videos) {
                    videomap.set(v.videoid, v);
                    if (!v.resolution) v.resolution = "1280x720";
                }
                filteredvideos = videos.slice();
                updatevideocount();
                filterbytab(activetab);
                listenscroll();
                if (searchinput) searchinput.addEventListener("input", handlesearch);
                if (watchclose) watchclose.addEventListener("click", closewatch);
                if (watchoverlay) watchoverlay.addEventListener("click", e => {if (e.target === watchoverlay) closewatch()});
                document.addEventListener("keydown", e => {if (e.key === "Escape" && watchoverlay?.classList.contains("visible")) closewatch()});
                for (const tab of tabs) {
                    tab.addEventListener("click", () => {
                        const tname = tab.dataset.tab;
                        if (tname) {
                            activetab = tname;
                            tabs.forEach(t => t.classList.remove("active"));
                            tab.classList.add("active");
                            filterbytab(tname);
                        }
                   });
                }
                window.addEventListener("hashchange", selectvideofromhash);
                selectvideofromhash();
            } catch (e) {
                videosroot.textContent = "Unable to load videos right now...";
            }
        }

        /*//////////////////////////////////////////////////////////////////////*/

        // bad implementation but setting res to 9:16 automatically groups the video into the shorts tab
        function filterbytab(tn) {
            filteredvideos = videos.filter(v => tn === "shorts" ? v.resolution === "720x1280" : v.resolution !== "720x1280");
            renderedcount = 0;
            videosroot.innerHTML = "";
            if (!filteredvideos.length) {
                const d = document.createElement("div");
                d.className = "empty-state";
                d.textContent = `No ${tn} available.`;
                videosroot.appendChild(d);
                return;
            }
            rendernextpage(true);
            setactivecard(activevideoid);
        }

        function handlesearch(e) {
            const q = (e.target.value || "").toLowerCase().trim();
            const base = activetab === "shorts" ? videos.filter(v => v.resolution === "720x1280") : videos.filter(v => v.resolution !== "720x1280");
            filteredvideos = !q ? base.slice() : base.filter(v => ((v.title||"").toLowerCase().includes(q) || (v.videoid||"").toLowerCase().includes(q)));
            renderedcount = 0;
            videosroot.innerHTML = "";
            if (!filteredvideos.length) {
                const d = document.createElement("div");
                d.className = "empty-state";
                d.textContent = "No videos found.";
                videosroot.appendChild(d);
                return;
            }
            rendernextpage(true);
            setactivecard(activevideoid);
        }

        function listenscroll() {
            window.addEventListener("scroll", () => {
                if (loading) return;
                const {scrollTop, scrollHeight, clientHeight } = document.documentElement;
                if (scrollTop + clientHeight >= scrollHeight - 300) rendernextpage();
           });
        }

        function rendernextpage(forced = false, tgtcount = renderedcount + 24) {
            if (loading) return;
            if (!forced && renderedcount >= filteredvideos.length) return;
            loading = true;
            const frag = document.createDocumentFragment();
            const next = Math.min(filteredvideos.length, tgtcount);
            const cards = [];
            for (let i = renderedcount; i < next; ++i) {
                const card = makevideocard(filteredvideos[i]);
                cards.push(card);
                frag.appendChild(card);
            }
            videosroot.appendChild(frag);
            renderedcount = next;
            loading = false;
            setactivecard(activevideoid);
            observeimages(cards);
        }

        /*//////////////////////////////////////////////////////////////////////*/

        function makevideocard(video) {
            const article = document.createElement("article");
            article.className = "videoitem";
            article.dataset.videoid = video.videoid;
            const thumb = video.thumbnail || `assets/images/nothumb.png`;
            const dlabel = formatduration(video.length);
            const pub = formatdate(video.publishdate);
            const aratio = video.resolution === "720x1280" ? "9 / 16" : "16 / 9";
            article.innerHTML = `
                <div class="videothumbnail" style="aspect-ratio: ${aratio};">
                    <img data-src="${thumb}" alt="${escapehtml(video.title)}" data-retries="0">
                    <div class="videoduration">${dlabel}</div>
                </div>
                <div class="videoinfo">
                    <img src="assets/images/pfp.webp" class="videochannelavatar" loading="lazy">
                    <div class="videodetails">
                        <div class="videotitle">${escapehtml(video.title)}</div>
                        <div class="videometa">
                            <span>${pub}</span>
                            <span class="videometaseparator">•</span>
                            <span>${dlabel}</span>
                        </div>
                    </div>
                </div>
            `;
            article.addEventListener("click", () => selectvideo(video.videoid));
            return article;
        }

        let imageobserver = null;

        function observeimages(cards) {
            if (!imageobserver) {
                imageobserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            const src = img.dataset.src;
                            if (src && !img.src) {
                                loadimage(img, src);
                            }
                            imageobserver.unobserve(img);
                        }
                   });
                }, {rootMargin: "200px"});
            }
            cards.forEach(card => {
                const img = card.querySelector(".videothumbnail img");
                if (img && img.dataset.src) {
                    const rect = img.getBoundingClientRect();
                    const isvisible = rect.top < window.innerHeight + 200 && rect.bottom > -200;
                    if (isvisible) {
                        loadimage(img, img.dataset.src);
                    } else {
                        imageobserver.observe(img);
                    }
                }
           });
        }

        function loadimage(img, src, retry = 0) {
            if (retry > 2 || !img) return;
            const cleanup = () => {
                img.removeEventListener("load", onload);
                img.removeEventListener("error", onerror);
            };
            const onload = () => {
                cleanup();
                img.classList.add("loaded");
                img.removeAttribute("data-src");
            };
            const onerror = () => {
                cleanup();
                if (retry < 2) {
                    setTimeout(() => loadimage(img, src, retry + 1), 1000 * (retry + 1));
                } else {
                    img.src = "assets/images/nothumb.png";
                    img.classList.add("loaded");
                }
            };
            img.addEventListener("load", onload);
            img.addEventListener("error", onerror);
            img.src = src;
        }

        function selectvideo(vid, hashup = true) {
            const v = videomap.get(vid);
            if (!v) return false;
            activevideoid = vid;
            if (hashup && window.location.hash !== `#${vid}`) window.location.hash = vid;
            ensurevideorendered(vid);
            setactivecard(vid);
            updatewatchpanel(v);
            showwatch();
            return true;
        }

        function ensurevideorendered(vid) {
            const i = filteredvideos.findIndex(v => v.videoid === vid);
            if (i === -1) return;
            while (renderedcount <= i && renderedcount < filteredvideos.length) rendernextpage(true, i + 1);
        }

        function setactivecard(vid) {
            document.querySelector(".videoitem.active")?.classList.remove("active");
            if (!vid) return;
            const c = document.querySelector(`.videoitem[data-videoid="${vid}"]`);
            if (c) c.classList.add("active");
        }

        function showwatch() {
            if (watchoverlay) {
                watchoverlay.classList.add("visible");
                document.body.style.overflow = "hidden";
            }
        }
        function closewatch() {
            if (watchoverlay) {
                watchoverlay.classList.remove("visible");
                document.body.style.overflow = "";
                if (watchframe) watchframe.src = "";
            }
        }

        /*//////////////////////////////////////////////////////////////////////*/

        function updatewatchpanel(v) {
            if (!watchpanel) return;
            watchtitle.textContent = v.title;
            const dlabel = formatduration(v.length);
            const pub = formatdate(v.publishdate);
            watchmeta.textContent = dlabel ? `${pub} • ${dlabel}` : pub;
            if (v.videoembed) {
                let em = v.videoembed;
                if (em.includes("/file/")) em = em.replace(/\/file\//, "/embed/").replace(/\/embed\/embed\//, "/embed/");
                watchframe.src = em;
            } else {
                watchframe.src = "";
            }
            updatedownloadlink(watchdownloadtranscript, v.transcript, "Transcript (.xlsx)");
            updatedownloadlink(watchdownloadcomments, v.comments, "Comments (.xlsx)");
            loaddescription(v);
        }

        /*//////////////////////////////////////////////////////////////////////*/

        async function loaddescription(v) {
            if (!watchdescription) return;
            if (!v.description) {
                watchdescription.innerHTML = "<i style='color:grey'>No description has been added to this video.</i>";
                watchdescription.className = "watchdescription";
                return;
            }
            if (descriptioncache.has(v.description)) {
                const c = descriptioncache.get(v.description);
                watchdescription.innerHTML = c.expanded ? c.fullhtml : c.collapsedhtml;
                watchdescription.className = c.expanded ? "watchdescription" : "watchdescription watchdescriptioncollapsed";
                if (!c.expanded) {
                    const more = watchdescription.querySelector(".watchdescriptionmore");
                    more?.addEventListener("click", () => {
                        watchdescription.innerHTML = c.fullhtml;
                        watchdescription.className = "watchdescription";
                        descriptioncache.set(v.description, {
                            fullhtml: c.fullhtml,
                            collapsedhtml: c.collapsedhtml,
                            expanded: true
                       });
                   });
                }
                return;
            }
            watchdescription.textContent = "Loading description…";
            watchdescription.className = "watchdescription";
            try {
                const encodedPath = v.description.split('/').map(segment => encodeURIComponent(segment)).join('/');
                const resp = await fetch(encodedPath);
                const raw = await resp.text();
                const norm = raw.replace(/\r\n/g, "\n").replace(/\n{3,}/g, "\n\n");
                const lines = norm.split("\n");
                const fullhtml = formatdescription(norm);
                if (lines.length <= 3) {
                    watchdescription.innerHTML = fullhtml;
                    watchdescription.className = "watchdescription";
                    descriptioncache.set(v.description, {fullhtml, collapsedhtml: null, expanded: true});
                } else {
                    const f3 = lines.slice(0, 3).join("\n");
                    const coll = formatdescription(f3);
                    const addmore = coll + '<span class="watchdescriptionmore"><b>more</b></span>';
                    watchdescription.innerHTML = addmore;
                    watchdescription.className = "watchdescription watchdescriptioncollapsed";
                    const more = watchdescription.querySelector(".watchdescriptionmore");
                    more?.addEventListener("click", () => {
                        watchdescription.innerHTML = fullhtml;
                        watchdescription.className = "watchdescription";
                        descriptioncache.set(v.description, {fullhtml, collapsedhtml: coll, expanded: true});
                   });
                    descriptioncache.set(v.description, {fullhtml, collapsedhtml: coll, expanded: false});
                }
            } catch (e) {
                watchdescription.textContent = "Couldn't load the description?!";
                watchdescription.className = "watchdescription";
            }
        }

        function updatedownloadlink(el, path, label) {
            if (!el) return;
            if (path) {
                el.hidden = false;
                el.href = path;
                el.textContent = label;
            } else {
                el.hidden = true;
                el.removeAttribute("href");
            }
        }

        /*//////////////////////////////////////////////////////////////////////*/

        function selectvideofromhash() {
            const vid = window.location.hash.replace("#", "").trim();
            if (!vid) return false;
            return selectvideo(vid, false);
        }
        function formatdescription(t = "") {
            if (!t.trim()) return "<i style='color:grey'>No description has been added to this video.</i>";
            const esc = escapehtml(t);
            return esc.split(/\n{2,}/).map(b => `<p>${b.replace(/\n/g, "<br>")}</p>`).join("");
        }
        function escapehtml(t) {
            const d = document.createElement("div");
            d.textContent = t;
            return d.innerHTML;
        }
        function formatduration(s = 0) {
            const tot = Number(s) || 0;
            const h = Math.floor(tot / 3600);
            const m = Math.floor((tot % 3600) / 60);
            const sec = tot % 60;
            if (h > 0) return `${h}:${String(m).padStart(2, "0")}:${String(sec).padStart(2, "0")}`;
            return `${m}:${String(sec).padStart(2, "0")}`;
        }
        function formatdate(ds = "") {
            const d = new Date(ds);
            if (Number.isNaN(d.getTime())) return ds || "";
            return d.toLocaleDateString(undefined, {month: "short", day: "numeric", year: "numeric"});
        }
        function updatevideocount() {
            const vc = document.getElementById("videocount");
            if (vc) vc.textContent = `${videos.length} video${videos.length===1 ? "" : "s"}`;
        }

    </script>
</body>
</html>
