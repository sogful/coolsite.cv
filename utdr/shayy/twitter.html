<!DOCTYPE html>
<html lang="en">
<head>

    <title>Twitter Archive</title>
    <link rel="icon" type="image/png" href="../assets/images/icons/notshayy.png">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <style>

        @font-face {
            font-family: "Chirp";
            src: url("assets/fonts/chirp.woff2");
            font-weight: 400;
        }
        @font-face {
            font-family: "Chirp";
            src: url("assets/fonts/chirpbold.woff2");
            font-weight: 700;
        }
        @font-face {
            font-family: "Chirp";
            src: url("assets/fonts/chirpheavy.woff2");
            font-weight: 900;
        }

        /*//////////////////////////////////////////////////////////////////////*/

        :root {
            --white: #e7e9ea;
            --blue: #1d9bf0;
            --grey: #71767b;
        }

        body {
            font-family: "Chirp";
            display: flex; justify-content: center;
            min-height: 100vh; margin: 0;
            background: #000; color: var(--white);
            overflow-y: auto; scrollbar-width: none;
        }
        ::-webkit-scrollbar {display: none}
        .page {
            width: min(90vw, 700px);
            padding-bottom: 40px;
        }
        :any-link {
            color: var(--blue); text-decoration: none;
            cursor: pointer !important
        }

        /*//////////////////////////////////////////////////////////////////////*/

        .search {
            position: relative;
            margin: 12px 0 12px; width: 90%;
        }
        .searchicon {
            position: absolute;
            left: 18px; top: 50%;
            transform: translateY(-50%);
            width: 18px; height: 18px;
            opacity: 0.5; pointer-events: none;
        }
        .searchbar {
            width: 100%; height: 44px; padding: 0 16px 0 48px;
            border-radius: 999px;
            border: 1px solid #2f3336;
            background: transparent; color: var(--white);
            font-family: inherit; font-size: 15px;
            caret-color: var(--blue);
        }
        .searchbar::placeholder {color: var(--grey)}
        .searchbar:focus {
            outline: none;
            border-color: var(--blue);
        }

        /*//////////////////////////////////////////////////////////////////////*/

        .note {
            display: flex; align-items: center; 
            background: rgba(255, 0, 0, 0.12);
            border: 1px solid #7a0000; color: var(--white);
            gap: 7px; border-radius: 10px;
            padding: 16px; font-size: 15px;
        }

        /*//////////////////////////////////////////////////////////////////////*/

        .profile {
            border-radius: 16px;
            overflow: hidden;
        }
        .profilebanner {
            height: 200px;
            background-size: cover;
            background-position: center;
        }
        .profilebody {
            position: relative;
            padding: 78px 16px 16px;
            background: #000;
        }
        .profileavatar {
            position: absolute;
            top: -64px; left: 16px;
            width: 128px; height: 128px;
            border-radius: 50%;
            border: 4px solid black;
        }
        .profileheader {display: flex}
        .profilenameblock {
            display: flex; flex-direction: column;
            gap: 4px;
        }
        .profilenamerow {display: flex; font-size: 22px; font-weight: 700}
        .profilehandle {color: var(--grey); font-size: 15px;}
        .profileactions {margin-left: auto; display: flex; gap: 8px;}

        b {color: white}

        .profilelinks, .profilemeta, .profilestats {
            display: flex; flex-wrap: wrap;
            font-size: 15px; margin-top: 12px;
            color: var(--grey);
        }
        .profilelinks span, .profilelinks a {padding-left: 3px; padding-right: 10px}
        .profilestats span {
            padding-right: 20px;
        }

        .profilestats a {
            text-decoration: none; 
            color: inherit; display: flex; gap: 4px;
        }
        .profilefollowed {
            margin-top: 12px; font-size: 15px;
            color: var(--grey);
        }

        /*//////////////////////////////////////////////////////////////////////*/

        .replying {
            color: var(--grey); padding-bottom: 2px;
        }
        .tweet {
            display: flex; position: relative; padding: 12px;
            border-bottom: 1px solid transparent;
            border-image: linear-gradient(to right, black 0%, rgb(47, 51, 54) 5% 95%, black 100%);
            border-image-slice: 1;
        }
        .avatar {
            width: 40px; height: 40px;
            border-radius: 50%; margin-right: 7px;
        }
        .content {flex: 1; min-width: 0}
        .header {
            display: flex; align-items: center;
            margin-bottom: 2px; gap: 4px;
        }
        .name {
            font-weight: 700;
            color: var(--white);
            font-size: 15px;
        }
        .handle {
            color: var(--grey);
            font-size: 15px;
            margin-left: 1px;
        }
        .date {
            color: var(--grey);
            font-size: 15px;
        }
        .text {
            color: var(--white);
            font-size: 15px; line-height: 20px;
            margin-bottom: 12px;
            white-space: pre-wrap;
        }

        /*//////////////////////////////////////////////////////////////////////*/

        .actions {
            display: flex; justify-content: space-between;
            max-width: 425px; margin-top: -7.5px; margin-left: -7.5px;
        }
        .action {
            display: flex; align-items: center;
            color: var(--grey); user-select: none;
            background: none; border: none;
            padding: 0; font-size: 13px;
            font-family: inherit; transition: color 0.2s;
            min-width: 60px;
        }
        .action span:last-child {
            min-width: 30px;
            text-align: left;
        }
        .actionicon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 34px; height: 34px;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        svg {
            width: 18.75px; height: 18.75px;
            fill: currentColor;
        }
        .action:hover {color: var(--blue)}
        .action:hover .actionicon {background-color: rgba(29,155,240,0.15)}
        .retweet:hover {color: #00BA7C !important}
        .retweet:hover .actionicon {background-color: rgba(0,186,124,0.15)}
        .like:hover {color: #EC177A !important}
        .like:hover .actionicon {background-color: rgba(249,24,128,0.15)}
        .reply, .retweet {cursor: pointer !important}
        [disabled] {opacity: 0.5; cursor: not-allowed !important}

        .emoji {
            user-select: none; cursor: help !important;
            font-stretch: condensed;
            letter-spacing: -1px; color: var(--grey);
            padding-right: 1px;
        }

        /*//////////////////////////////////////////////////////////////////////*/

        .info {
            position: absolute;
            text-align: right;
            right: 1em; top: 1.5em; font-size: 0.5em; 
            color: var(--grey);
            display: flex;
            flex-direction: column;
            gap: 0.2em;
        }
        .info .id {
            font-size: 1.25em;
        }

        /*//////////////////////////////////////////////////////////////////////*/
    </style>
</head>
<body>
    <div class="page">

        <section class="profile">
            <div class="profilebanner" style="background-image: url('assets/images/banner.webp');"></div>
            <div class="profilebody">
                <img src="assets/images/pfp.jpg" alt="Shayy" class="profileavatar">
                <div class="profileheader">
                    <div class="profilenameblock">
                        <div class="profilenamerow">
                            <span>Shayy</span>
                        </div>
                        <span class="profilehandle">@Shayy_TV</span>
                    </div>
                </div>

                <div class="profilelinks">

                    <svg aria-hidden="true" viewBox="0 0 24 24"><path d="M18.4 5.6a5 5 0 0 0-7.1 0L9.9 7.1 8.5 5.6l1.4-1.4a7 7 0 0 1 9.9 10l-1.4 1.3-1.4-1.4 1.4-1.4c2-2 2-5.1 0-7m-2.2 3.6-7 7-1.4-1.4 7-7zm-12 .7 1.4-1.4L7 9.9l-1.4 1.4a5 5 0 0 0 0 7c2 2 5.1 2 7.1 0l1.4-1.4 1.4 1.5-1.4 1.4a7 7 0 0 1-9.9-10"/></svg>
                    <a href="https://youtube.com/@ShayyTV" target="_blank" rel="noopener noreferrer">youtube.com/@ShayyTV</a>

                    <svg aria-hidden="true" viewBox="0 0 24 24"><path d="M7 4V3h2v1h6V3h2v1h1.5C19.9 4 21 5.1 21 6.5v12c0 1.4-1.1 2.5-2.5 2.5h-13A2.5 2.5 0 0 1 3 18.5v-12Q3.2 4.2 5.5 4zm0 2H5.5Q5 6 5 6.5v12q0 .5.5.5h13q.5 0 .5-.5v-12q0-.5-.5-.5H17v1h-2V6H9v1H7zm0 6h2v-2H7zm0 4h2v-2H7zm4-4h2v-2h-2zm0 4h2v-2h-2zm4-4h2v-2h-2z"/></svg>
                    <span>Joined June 16, 2017</span>
                </div>
                <div class="profilestats">
                    <a><b>870</b><span>Following</span></a>
                    <a><b>74k</b><span>Followers</span></a>
                </div>
            </div>
        </section>

        <div class="note">
            <svg viewBox="0 0 24 24" aria-hidden="true" class="r-4qtqp9 r-yyyyoo r-dnmrzs r-bnwqim r-lrvibr r-m6rgpd r-1472mwg r-lrsllp r-jwli3a" xmlns="http://www.w3.org/2000/svg" transform="scale(-1)"><path d="M13.5 8.5c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5S11.17 7 12 7s1.5.67 1.5 1.5M13 17v-5h-2v5zm-1 5.25c5.66 0 10.25-4.59 10.25-10.25S17.66 1.75 12 1.75 1.75 6.34 1.75 12 6.34 22.25 12 22.25M20.25 12c0 4.56-3.69 8.25-8.25 8.25S3.75 16.56 3.75 12 7.44 3.75 12 3.75s8.25 3.69 8.25 8.25"/></svg>
            <div>Tweets from 1/1/2023 to 12/16/2023 (~8k) are unavailable as of now due to limitations.</div>
        </div>

        <div class="search">
            <svg class="searchicon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.3 3.8a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13m-8.5 6.5a8.5 8.5 0 1 1 15.1 5.2l4.8 4.8-1.4 1.4-4.8-4.8a8.5 8.5 0 0 1-13.7-6.6"/></svg>
            <input class="searchbar" placeholder="Search (Some Twitter syntax supported)">
        </div>

        <div id="tweets" aria-live="polite"></div>

    </div>

    <script>
        const tweetsRoot = document.getElementById("tweets");
        const searchInput = document.querySelector(".searchbar");
        let tweets = []; let filteredTweets = [];
        let renderedCount = 0;
        let loading = false;

        init();

        async function init() {
            try {
                const csvText = await fetch("assets/static/tweets.csv").then((res) => res.text());
                const rows = parseCSV(csvText.trim());
                const headers = rows.shift().map((header) => header.trim());
                tweets = rows
                    .filter((row) => row.length && row.some((cell) => cell.trim() !== ""))
                    .map((row) => headers.reduce((acc, key, idx) => {
                        acc[key] = row[idx] ?? "";
                        return acc;
                    }, {}));
                filteredTweets = tweets.slice();
                renderNextPage();
                attachScrollListener();
                searchInput?.addEventListener("input", handleSearch);
            } catch (error) {
                tweetsRoot.textContent = "Unable to load tweets right now.";
                console.error(error);
            }
        }

        /*//////////////////////////////////////////////////////////////////////*/

        function parseCSV(text) {
            const rows = [];
            let current = "";
            let inQuotes = false;
            let row = [];

            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const next = text[i + 1];

                if (char === '"') {
                    if (inQuotes && next === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === "," && !inQuotes) {
                    row.push(current);
                    current = "";
                } else if ((char === "\n" || char === "\r") && !inQuotes) {
                    if (char === "\r" && next === "\n") i++;
                    row.push(current);
                    rows.push(row);
                    row = [];
                    current = "";
                } else {
                    current += char;
                }
            }

            if (current || row.length) {
                row.push(current);
                rows.push(row);
            }

            return rows;
        }

        function handleSearch(event) {
            const query = event.target.value || "";
            const searchParams = parseSearchQuery(query);
            filteredTweets = tweets.filter((tweet) => {
                return matchesSearch(tweet, searchParams);
            });
            renderedCount = 0;
            tweetsRoot.innerHTML = "";
            renderNextPage(true);
        }

        function parseSearchQuery(query) {
            const params = {
                text: [],
                lang: null,
                url: null,
                to: null,
                mentions: [],
                since: null,
                until: null,
                sinceTime: null,
                untilTime: null,
                sinceId: null,
                maxId: null,
                minRetweets: null,
                minFaves: null,
                minReplies: null,
                maxRetweets: null,
                maxFaves: null,
                maxReplies: null
            };

            const quotedmatches = query.match(/"([^"]+)"/g);
            if (quotedmatches) {
                quotedmatches.forEach(match => {
                    params.text.push(match.slice(1, -1));
                });
                query = query.replace(/"([^"]+)"/g, "");
            }

            // operators
            const operators = [
                { pattern: /lang:(\w+)/gi, key: "lang" },
                { pattern: /url:([^\s]+)/gi, key: "url" },
                { pattern: /to:([\w_]+)/gi, key: "to" },
                { pattern: /@([\w_]+)/g, key: "mentions", isArray: true },
                { pattern: /since:(\d{4}-\d{2}-\d{2}(?:_\d{2}:\d{2}:\d{2}_\w+)?)/gi, key: "since" },
                { pattern: /until:(\d{4}-\d{2}-\d{2}(?:_\d{2}:\d{2}:\d{2}_\w+)?)/gi, key: "until" },
                { pattern: /since_time:(\d+)/gi, key: "sinceTime" },
                { pattern: /until_time:(\d+)/gi, key: "untilTime" },
                { pattern: /since_id:(\d+)/gi, key: "sinceId" },
                { pattern: /max_id:(\d+)/gi, key: "maxId" },
                { pattern: /min_retweets:(\d+)/gi, key: "minRetweets" },
                { pattern: /min_faves:(\d+)/gi, key: "minFaves" },
                { pattern: /min_replies:(\d+)/gi, key: "minReplies" },
                { pattern: /-min_retweets:(\d+)/gi, key: "maxRetweets" },
                { pattern: /-min_faves:(\d+)/gi, key: "maxFaves" },
                { pattern: /-min_replies:(\d+)/gi, key: "maxReplies" }
            ];

            operators.forEach(({ pattern, key, isArray }) => {
                const matches = query.matchAll(pattern);
                for (const match of matches) {
                    if (isArray) {
                        params[key].push(match[1]);
                    } else {
                        params[key] = match[1];
                    }
                    query = query.replace(match[0], ""); // Remove from query
                }
            });

            // Remaining text (after removing operators and quotes)
            const remainingText = query.trim();
            if (remainingText) {
                params.text.push(remainingText);
            }

            return params;
        }

        function matchesSearch(tweet, params) {
            // Text search (quoted phrases and remaining text)
            if (params.text.length > 0) {
                const fullText = (tweet.full_text || "").toLowerCase();
                for (const text of params.text) {
                    const searchText = text.toLowerCase();
                    // For phrases with spaces, check for exact match or hyphenated version
                    if (text.includes(" ")) {
                        const hyphenated = searchText.replace(/\s+/g, "-");
                        if (!fullText.includes(searchText) && !fullText.includes(hyphenated)) {
                            return false;
                        }
                    } else {
                        if (!fullText.includes(searchText)) {
                            return false;
                        }
                    }
                }
            }

            // Language filter
            if (params.lang && (tweet.lang || "").toLowerCase() !== params.lang.toLowerCase()) {
                return false;
            }

            // URL filter
            if (params.url) {
                const fullText = tweet.full_text || "";
                if (!fullText.includes(params.url)) {
                    return false;
                }
            }

            // Reply to filter
            if (params.to) {
                const fullText = tweet.full_text || "";
                if (!fullText.toLowerCase().startsWith(`@${params.to.toLowerCase()}`)) {
                    return false;
                }
            }

            // mentions filter
            if (params.mentions.length > 0) {
                const mentions = parsementions(tweet.user_mentions);
                const mentionLower = mentions.map(m => m.toLowerCase());
                for (const mention of params.mentions) {
                    if (!mentionLower.includes(mention.toLowerCase())) {
                        return false;
                    }
                }
            }

            // Date filters
            if (params.since || params.until || params.sinceTime || params.untilTime) {
                const tweetDate = new Date(tweet.created_at);
                if (isNaN(tweetDate.getTime())) return false;

                if (params.since) {
                    const sinceDate = parseDateParam(params.since);
                    if (tweetDate < sinceDate) return false;
                }

                if (params.until) {
                    const untilDate = parseDateParam(params.until);
                    if (tweetDate >= untilDate) return false;
                }

                if (params.sinceTime) {
                    const sinceTimestamp = parseInt(params.sinceTime) * 1000;
                    if (tweetDate.getTime() < sinceTimestamp) return false;
                }

                if (params.untilTime) {
                    const untilTimestamp = parseInt(params.untilTime) * 1000;
                    if (tweetDate.getTime() >= untilTimestamp) return false;
                }
            }

            // ID filters
            if (params.sinceId) {
                const tweetId = BigInt(tweet.tweet_id || 0);
                const sinceId = BigInt(params.sinceId);
                if (tweetId <= sinceId) return false;
            }

            if (params.maxId) {
                const tweetId = BigInt(tweet.tweet_id || 0);
                const maxId = BigInt(params.maxId);
                if (tweetId > maxId) return false;
            }

            // Count filters
            const retweets = parseInt(tweet.retweet_count || 0);
            const faves = parseInt(tweet.favorite_count || 0);
            const replies = parseInt(tweet.reply_count || 0);

            if (params.minRetweets && retweets < parseInt(params.minRetweets)) return false;
            if (params.minFaves && faves < parseInt(params.minFaves)) return false;
            if (params.minReplies && replies < parseInt(params.minReplies)) return false;
            if (params.maxRetweets && retweets > parseInt(params.maxRetweets)) return false;
            if (params.maxFaves && faves > parseInt(params.maxFaves)) return false;
            if (params.maxReplies && replies > parseInt(params.maxReplies)) return false;

            return true;
        }

        function parseDateParam(dateStr) {
            // Handle format: YYYY-MM-DD or YYYY-MM-DD_HH:MM:SS_TZ
            if (dateStr.includes("_")) {
                // Format: YYYY-MM-DD_HH:MM:SS_TZ
                const [datePart, timePart, tz] = dateStr.split("_");
                const [year, month, day] = datePart.split("-");
                const [hour, minute, second] = timePart.split(":");
                // Note: Timezone handling is simplified - UTC is assumed for most cases
                return new Date(Date.UTC(
                    parseInt(year),
                    parseInt(month) - 1,
                    parseInt(day),
                    parseInt(hour),
                    parseInt(minute),
                    parseInt(second)
                ));
            } else {
                // Format: YYYY-MM-DD - set to start of day (00:00:00)
                const [year, month, day] = dateStr.split("-");
                return new Date(parseInt(year), parseInt(month) - 1, parseInt(day), 0, 0, 0);
            }
        }

        function attachScrollListener() {
            window.addEventListener("scroll", () => {
                if (loading) return;
                const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
                if (scrollTop + clientHeight >= scrollHeight - 200) {
                    renderNextPage();
                }
            });
        }

        function renderNextPage(force = false) {
            if (loading) return;
            if (!force && renderedCount >= filteredTweets.length) return;

            loading = true;
            const fragment = document.createDocumentFragment();
            const targetCount = Math.min(filteredTweets.length, renderedCount + 25);

            for (let i = renderedCount; i < targetCount; i++) {
                fragment.appendChild(createTweet(filteredTweets[i]));
            }

            tweetsRoot.appendChild(fragment);
            renderedCount = targetCount;
            loading = false;
        }

        function createTweet(tweet) {
            const article = document.createElement("article");
            article.className = "tweet";

            const mentions = parsementions(tweet.user_mentions);
            const isaquote = tweet.is_quote_status === "TRUE";
            const isareply = mentions.length > 0;
            const lang = tweet.lang || "und";
            
            let tweetText = tweet.full_text || "";
            if (isareply) {tweetText = cleanmentions(tweetText, mentions)}

            // tweet info
            const infoparts = [];
            if (mentions.length) {infoparts.push(formatmentions(mentions))}
            infoparts.push(`lang: <a>${lang}</a>`);
            infoparts.push(isareply ? "reply" : (isaquote ? "quote" : "tweet"));
            const infoLine = infoparts.join(" // ");

            article.innerHTML = `
                <img src="assets/images/pfp.webp" class="avatar" draggable="false" alt="profile photo">
                <div class="content">
                    <div class="header">
                        <span class="name">Shayy</span>
                        <span class="handle">@Shayy_TV</span>
                        <span class="date">· ${formatDate(tweet.created_at)}</span>
                    </div>
                    ${isareply ? `<div class="replying">Replying to ${formatmentions(mentions)}</div>` : ""}
                    <div class="text">${formattxt(tweetText)}</div>
                    <div class="actions">
                        ${actionButton("reply", tweet.reply_count, replyicon(), false, tweet.tweet_id)}
                        ${actionButton("retweet", tweet.retweet_count, retweeticon(), false, tweet.tweet_id)}
                        ${actionButton("like", tweet.favorite_count, likeicon())}
                        ${actionButton("views", tweet.view_count, viewsicon())}
                        ${actionButton("bookmark", tweet.bookmark_count, bookmarkicon(), true)}
                        ${actionButton("share", tweet.quote_count, shareicon(), true)}
                    </div>
                    <div class="info">
                        <span class="id">${tweet.tweet_id}</span>
                        ${infoLine ? `<span>${infoLine}</span>` : ""}
                    </div>
                </div>
            `;

            const replybutton = article.querySelector(".action.reply");
            const retweetbutton = article.querySelector(".action.retweet");
            if (replybutton) {
                replybutton.addEventListener("click", () => {
                    window.open(`https://x.com/search?q=conversation_id%3A${tweet.tweet_id}&src=typed_query&f=live`, "_blank");
                });
            }
            if (retweetbutton) {
                retweetbutton.addEventListener("click", () => {
                    window.open(`https://x.com/search?q=quoted_tweet_id%3A${tweet.tweet_id}&src=typed_query&f=live`, "_blank");
                });
            }

            return article;
        }

        function cleanmentions(text, mentions) {
            let cleaned = text.trim();
            let changed = true;
            while (changed) {
                changed = false;
                for (const mention of mentions) {
                    const pattern = new RegExp(`^@${mention}\\s+`, "i");
                    if (pattern.test(cleaned)) {
                        cleaned = cleaned.replace(pattern, "").trim();
                        changed = true;
                        break;
                    }
                }
            } return cleaned;
        }

        function actionButton(type, count, icon, disabled = false, tweetId = null) {
            const buttonAttrs = disabled ? " disabled" : "";
            const countNum = parseInt(count) || 0;
            const showCount = type !== "share" && countNum > 0;
            return `
                <button class="action ${type}"${buttonAttrs}>
                    <span class="actionicon">${icon}</span>
                    ${showCount ? `<span>${formatNumber(count)}</span>` : ""}
                </button>
            `;
        }

        /*//////////////////////////////////////////////////////////////////////*/

        function replyicon() {return `<svg viewBox="0 0 24 24"><path d="M1.751 10c0-4.42 3.584-8 8.005-8h4.366c4.49 0 8.129 3.64 8.129 8.13 0 2.96-1.607 5.68-4.196 7.11l-8.054 4.46v-3.69h-.067c-4.49.1-8.183-3.51-8.183-8.01zm8.005-6c-3.317 0-6.005 2.69-6.005 6 0 3.37 2.77 6.08 6.138 6.01l.351-.01h1.761v2.3l5.087-2.81c1.951-1.08 3.163-3.13 3.163-5.36 0-3.39-2.744-6.13-6.129-6.13H9.756z"></path></svg>`}
        function retweeticon() {return `<svg viewBox="0 0 24 24"><path d="M4.5 3.88 8.932 8.02l-1.364 1.46L5.5 7.55V16c0 1.1.896 2 2 2H13v2H7.5c-2.209 0-4-1.79-4-4V7.55L1.432 9.48.068 8.02 4.5 3.88zm12 2.12H11V4h5.5c2.209 0 4 1.79 4 4v8.45l2.068-1.93 1.364 1.46-4.432 4.14-4.432-4.14 1.364-1.46 2.068 1.93V8c0-1.1-.896-2-2-2z"></path></svg>`}
        function likeicon() {return `<svg viewBox="0 0 24 24"><path d="M16.697 5.5c-1.222-.06-2.679.51-3.89 2.16l-.805 1.09-.806-1.09C9.984 6.01 8.526 5.44 7.304 5.5c-1.243.07-2.349.78-2.91 1.91-.552 1.12-.633 2.78.479 4.82 1.074 1.97 3.257 4.27 7.129 6.61 3.87-2.34 6.052-4.64 7.126-6.61 1.111-2.04 1.03-3.7.477-4.82-.561-1.13-1.666-1.84-2.908-1.91zm4.187 7.69c-1.351 2.48-4.001 5.12-8.379 7.67l-.503.3-.504-.3c-4.379-2.55-7.029-5.19-8.382-7.67-1.36-2.5-1.41-4.86-.514-6.67.887-1.79 2.647-2.91 4.601-3.01 1.651-.09 3.368.56 4.798 2.01 1.429-1.45 3.146-2.1 4.796-2.01 1.954.1 3.714 1.22 4.601 3.01.896 1.81.846 4.17-.514 6.67z"></path></svg>`}
        function viewsicon() {return `<svg viewBox="0 0 24 24"><path d="M8.75 21V3h2v18h-2zM18 21V8.5h2V21h-2zM4 21l.004-10h2L6 21H4zm9.248 0v-7h2v7h-2z"></path></svg>`}
        function bookmarkicon() {return `<svg viewBox="0 0 24 24"><path d="M4 4.5C4 3.12 5.119 2 6.5 2h11C18.881 2 20 3.12 20 4.5v18.44l-8-5.71-8 5.71V4.5zm2.5-.5q-.5 0-.5.5v14.56l6-4.29 6 4.29V4.5q0-.5-.5-.5z"></path></svg>`}
        function shareicon() {return `<svg viewBox="0 0 24 24"><path d="M12 2.59 6.3 8.3l1.41 1.41L11 6.41V16h2V6.41l3.3 3.3 1.41-1.42zm9 12.41-.02 3.51c0 1.38-1.12 2.49-2.5 2.49H5.5C4.11 21 3 19.88 3 18.5V15h2v3.5q0 .5.5.5h12.98q.5 0 .5-.5L19 15z"></path></svg>`}

        /*//////////////////////////////////////////////////////////////////////*/

        function parsementions(value = "") {
            return value
                .split(/;\s*/)
                .map((mention) => mention.trim())
                .filter(Boolean);
        }

        function formatmentions(mentions) {
            return mentions
                .map((mention) => `<a href="https://x.com/${mention}" target="_blank">@${mention}</a>`)
                .join(", ");
        }

        function formattxt(text) {
            const sanitized = normalizeEmojiPlaceholders(text || "");
            const escaped = htmlfix(sanitized);
            const emojiplaceholder = escaped.replace(/\(emoji\)/g, '<span class="emoji" title="Twemojis could not be properly saved.">(emoji)</span>');
            const linkified = emojiplaceholder
                .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>')
                .replace(/(^|\s)@([\w_]+)/g, (_, space, handle) => `${space}<a href="https://x.com/${handle}" target="_blank">@${handle}</a>`);
            return linkified.replace(/\n/g, "<br>");
        }

        function htmlfix(string) {
            const map = {
                "&": "&amp;",
                "<": "&lt;",
                ">": "&gt;",
                '"': "&quot;",
                "'": "&#39;"
            };
            return string.replace(/[&<>"']/g, (char) => map[char]);
        }

        function normalizeEmojiPlaceholders(text) {
            return text.replace(/�+/g, (match) => {
                const count = Math.max(1, Math.floor(match.length / 2));
                return "(emoji)".repeat(count);
            });
        }

        function formatNumber(value) {
            const number = Number(value) || 0;
            return Intl.NumberFormat("en", { notation: "compact", maximumFractionDigits: 1 }).format(number);
        }

        function formatDate(dateString = "") {
            const date = new Date(dateString);
            if (Number.isNaN(date.getTime())) return dateString;
            const datePart = date.toLocaleDateString(undefined, { month: "short", day: "numeric", year: "numeric" });
            const timePart = date.toLocaleTimeString(undefined, { hour: "numeric", minute: "2-digit" });
            return `${datePart}, ${timePart}`;
        }
    </script>
</body>
</html>
