<!DOCTYPE html>
<html lang="en">
<head>

    <title>UTDR</title>
    <link rel="icon" type="image/png" href="icon.png">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="googlebot" content="index,follow">
    <meta name="google" content="notranslate">

    <!-- the css import is too slow so this will almost always load faster -->
    <link rel="preload" as="font" type="font/woff2" href="assets/fonts/script.woff2" crossorigin>

    <style>

        @font-face {
            font-family: "script";
            src: url("assets/fonts/script.woff2") format("woff2");
            font-display: swap;
        }
        body {
            background-color: black; color: white;
            height: 100vh; margin: 0;
            display: flex; align-items: center; justify-content: flex-start;
            flex-direction: column; image-rendering: pixelated; overflow: hidden;
        }
        canvas, img, p, a {
            image-rendering: pixelated;
            user-select: none;
        }
        a, p {
            font-family: "script"; text-align: center;
            font-size: 72px; line-height: 72px;
            -webkit-font-smoothing: none; -moz-osx-font-smoothing: grayscale;
            font-smooth: never; text-rendering: geometricPrecision;
            text-rendering: optimizeLegibility; 
        }

        /*//////////////////////////////////////////////////////////////////////*/

        .restinpeace {
            position: fixed; display: flex; filter: grayscale(1);
            width: 100vw; height: 100vh; align-items: center;
            background-color: black; z-index: 9999; display: none;
        }
        .restinpeace img {
            display: flex; margin-left: 10%; 
            height: 40%;
        }

        .dawg {
            margin-top: 0; height: 50%;
            width: auto; 
        }
        .text {
            margin-top: 0; max-width: 90%;
            width: auto; object-fit: contain;
        }

        .tv {
            animation: spinny 2s linear infinite;
            transform-style: preserve-3d;
            width: 100%;
            display: block;
        }
        .wrapper {
            position: fixed; display: flex;
            top: 1em; right: 1em; opacity: 0.25;
            width: 3.5em; z-index: 1000;
        }

        /*//////////////////////////////////////////////////////////////////////*/

        .bottom {
            position: fixed; display: flex;
            flex-direction: row;
            bottom: 3em; justify-content: center; align-items: center;
        }
        .button {
            display: flex;
            width: 0.75em; height: 0.75em;
            justify-content: center; align-items: center;
            overflow: hidden; user-select: none;
            padding: 0 0.1em;
        }
        .button img {
            width: 100%; height: 100%;
            object-fit: contain;
        }
        .wip {filter: grayscale(1); opacity: 0.5}
        [href="shayy"] img {image-rendering: auto !important}

        @keyframes spinny {
            0% {transform: perspective(600px) rotateY(0deg)}
            100% {transform: perspective(600px) rotateY(360deg)}
        }
    </style>

</head>
<body>

    <audio class="AAH" src="assets/audio/snd_glassbreak.mp3" preload="auto"></audio>

    <div class="restinpeace">
        <img src="assets/images/rip.webp" draggable="false">
    </div>

    <img class="dawg" src="assets/images/corgi.gif" draggable="false">
    <a class="text">random stuff</a>

    <div class="wrapper">
        <img class="tv" src="assets/svgs/happiestcreature.svg" draggable="false">
    </div>

    <div class="bottom">
        <a class="button" href="shayy">
            <img src="assets/images/icons/notshayy.png">
        </a>
        <a class="button wip">
            <img src="assets/images/icons/echo.gif">
        </a>
    </div>

    <script>

        var context = new (window.AudioContext || window.webkitAudioContext)();
        var volume = context.createGain();
        const wrapper = document.querySelector(".wrapper");
        const teevee = document.querySelector(".tv");
        const scalableText = document.getElementById("scalable-text");

        volume.gain.value = 0.7;
        volume.connect(context.destination);

        var sounds = [
            "assets/audio/its_tv_time.mp3",
            "assets/audio/snd_tv_voice_short.mp3", "assets/audio/snd_tv_voice_short_2.mp3",
            "assets/audio/snd_tv_voice_short_3.mp3", "assets/audio/snd_tv_voice_short_4.mp3",
            "assets/audio/snd_tv_voice_short_5.mp3", "assets/audio/snd_tv_voice_short_6.mp3",
            "assets/audio/snd_tv_voice_short_7.mp3", "assets/audio/snd_tv_voice_short_8.mp3",
            "assets/audio/snd_tv_voice_short_9.mp3", "assets/audio/snd_tv_voice_short_10.mp3"
        ];

        var buffers = {};
        var loaded = 0;

        // web audio api jumps in to fix audio cutoffs and save the day #SWAG
        function sfxfix() {
            for (let i = 0; i < sounds.length; i++) {
                let req = new XMLHttpRequest();
                req.open("GET", sounds[i], true);
                req.responseType = "arraybuffer";
                req.onload = function () {
                    context.decodeAudioData(req.response, function (buffer) {
                        buffers[sounds[i]] = buffer;
                        loaded++;
                    });
                };
                req.send();
            }
        }; sfxfix();

        ////////////////////////////////////////////////////////////////
        
        let scale = 1; let target = 1;
        let anim = null; let deflate = null;

        function setscale(val) {
            scale = val;
            wrapper.style.transform = `scale(${scale})`;
        }
        function ensureanim() {
            if (!anim) anim = requestAnimationFrame(animate);
        }
        function stopanim() {
            if (anim) {
                cancelAnimationFrame(anim);
                anim = null;
            }
        }
        function animate() {
            const d = (target - scale) * 0.15;
            if (Math.abs(d) < 0.005) {
                setscale(target);
                stopanim();
                if (scale >= 4) {
                    wrapper.style.display = "none";
                    return;
                }
                if (scale > 1 && !deflate) {
                    deflate = setTimeout(() => {
                        if (wrapper.style.display !== "none" && target === scale) {
                            deflateanim();
                        }; deflate = null;
                    }, 200);
                }
                return;
            }
            setscale(scale + d);
            if (scale >= 4) {
                wrapper.style.display = "none";
                stopanim(); return;
            }
            anim = requestAnimationFrame(animate);
        }   

        function inflateanim(inc) {
            if (wrapper.style.display === "none") return;
            if (deflate) { clearTimeout(deflate); deflate = null}
            const add = inc || 0.25;
            target = Math.min(scale + add, 4);
            if (target >= 4) {
                setscale(4); wrapper.style.display = "none";
                if (context && context.state !== "closed") {
                    context.close();
                    context = new (window.AudioContext || window.webkitAudioContext)();
                    volume = context.createGain(); volume.gain.value = 0.7;
                    volume.connect(context.destination);
                }
                document.querySelector(".AAH").play();

                function musicfix() {
                    if (!window.teeveebuffer) {
                        if (!window.teeveepreload) {
                            window.teeveepreload = new Promise((resolve, reject) => {
                                let req = new XMLHttpRequest();
                                req.open("GET", "assets/audio/tv_results_screen_edit.mp3", true); 
                                req.responseType = "arraybuffer";
                                req.onload = function () {
                                    context.decodeAudioData(req.response, function (audioBuffer) {
                                        window.teeveebuffer = audioBuffer;
                                        resolve(audioBuffer);
                                    }, reject);
                                };
                                req.onerror = reject;
                                req.send();
                            });
                        }
                        window.teeveepreload.then(() => {
                            if (context && context.state === "suspended") context.resume();
                            var music = context.createBufferSource();
                            music.buffer = window.teeveebuffer; music.loop = true;
                            music.connect(volume); music.start(0);
                            window.music = music;

                            const rip = document.querySelector(".restinpeace");
                            if (rip) {
                                rip.style.display = "flex"; rip.style.opacity = 0; let opacity = 0;
                                const fade = () => {
                                    opacity += 0.025;
                                    if (opacity >= 1) {rip.style.opacity = 1}
                                    else {
                                        rip.style.opacity = opacity;
                                        requestAnimationFrame(fade);
                                    }
                                }; requestAnimationFrame(fade);
                            }
                        });
                    } else {
                        if (context && context.state === "suspended") context.resume();
                        if (window.music) {try {window.music.stop()} catch(e){}}
                        var music = context.createBufferSource();
                        music.buffer = window.teeveebuffer; music.loop = true;
                        music.connect(volume); music.start(0);
                        window.music = music;
                    }
                }; musicfix();
                return;
            }; ensureanim();
        }
        function deflateanim() {
            if (wrapper.style.display === "none") return;
            target = 1; ensureanim();
        }

        wrapper.addEventListener("click", function () {
            if (loaded < sounds.length) return;
            var src = sounds[Math.floor(Math.random() * sounds.length)];
            var buffer = buffers[src]; if (!buffer) return;
            var sfx = context.createBufferSource(); sfx.buffer = buffer;
            sfx.playbackRate.value = 1 + ((scale - 1) * 0.25) + (Math.random() * 0.1 - 0.05);
            sfx.connect(volume); sfx.start(0);
            if (wrapper.style.display === "none") return;
            inflateanim(0.25);
        });
        wrapper.addEventListener("mouseleave", function () {
            if (wrapper.style.display !== "none" && scale > 1) {
                deflateanim();
            }
        });
    </script>
</body>